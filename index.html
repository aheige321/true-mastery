<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>真掌握 - Anki风格记忆</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="app-header">
        <div class="logo">真掌握</div>
        <div class="header-actions">
            <i class="fas fa-search" id="btn-header-search" title="搜索"></i>
            <i class="fas fa-expand" id="btn-fullscreen" title="全屏模式"></i>
            <i class="fas fa-moon" id="theme-toggle" title="夜间模式"></i>
            <i class="fas fa-sync-alt" id="sync-btn" title="同步"></i>
        </div>
    </header>

    <main class="container" id="main-container">
        <div id="view-decks" class="view active">
            <div class="stats-bar" id="global-stats"><span>加载中...</span></div>
            <div class="deck-list" id="deck-list"></div>
            <div class="empty-state hidden" id="empty-state"><i class="fas fa-layer-group"></i><p>暂无记忆库，点击底部 + 号添加</p></div>
        </div>

        <div id="view-stats" class="view hidden">
            <div class="stats-container">
                <div class="stats-card">
                    <h3>学习活跃度 (最近一年)</h3>
                    <div class="heatmap-scroll">
                        <div class="heatmap" id="stats-heatmap"></div>
                    </div>
                </div>

                <div class="stats-card">
                    <h3>卡片分布</h3>
                    <div class="chart-wrapper">
                        <div class="pie-chart" id="stats-pie-chart"></div>
                        <div class="chart-legend">
                            <div class="legend-item"><span class="dot new"></span><span id="stat-new">新卡片: 0</span></div>
                            <div class="legend-item"><span class="dot learning"></span><span id="stat-learning">学习中: 0</span></div>
                            <div class="legend-item"><span class="dot review"></span><span id="stat-review">待复习: 0</span></div>
                            <div class="legend-item"><span class="dot mastered"></span><span id="stat-mastered">已掌握: 0</span></div>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <h3>数据概览</h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-num" id="total-decks">0</div>
                            <div class="stat-label">记忆库</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-num" id="total-cards">0</div>
                            <div class="stat-label">总卡片</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-settings" class="view hidden">
            <div class="settings-list">
                <div class="setting-group">
                    <div class="setting-title">语音设置</div>
                    <div class="setting-item">
                        <span>朗读语速</span>
                        <select id="setting-tts-rate">
                            <option value="0.8">0.8x (慢)</option>
                            <option value="1.0" selected>1.0x (正常)</option>
                            <option value="1.2">1.2x (快)</option>
                            <option value="1.5">1.5x (极快)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>自动朗读次数</span>
                        <select id="setting-tts-repeat">
                            <option value="1" selected>1 遍</option>
                            <option value="2">2 遍</option>
                            <option value="3">3 遍</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>优先使用百度语音</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-use-online-tts">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>自动朗读正面</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-auto-speak-front">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>自动朗读背面</span>
                        <label class="switch">
                            <input type="checkbox" id="setting-auto-speak-back">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-group">
                    <div class="setting-title">学习设置</div>
                    <div class="setting-item">
                        <span>每天新学数量</span>
                        <select id="setting-new-limit">
                            <option value="5">5 张</option>
                            <option value="10">10 张</option>
                            <option value="20" selected>20 张</option>
                            <option value="50">50 张</option>
                            <option value="9999">不限制</option>
                        </select>
                    </div>
                </div>
                <div class="setting-group"><div class="setting-title">数据管理</div>
                    <div class="setting-item clickable" id="btn-view-trash"><span><i class="fas fa-trash-restore"></i> 回收站</span><i class="fas fa-chevron-right"></i></div>
                    <div class="setting-item clickable" id="btn-export-json"><span><i class="fas fa-file-export"></i> 导出备份</span><i class="fas fa-chevron-right"></i></div>
                    <div class="setting-item clickable" id="btn-import-json"><span><i class="fas fa-file-import"></i> 导入备份</span><i class="fas fa-chevron-right"></i></div>
                    <input type="file" id="file-import-input" accept=".json" style="display: none;">
                    <div class="setting-item clickable" id="btn-download-cloud"><span><i class="fas fa-cloud-download-alt" style="color: #4cc9f0;"></i> 从云端下载</span><i class="fas fa-chevron-right"></i></div>
                    <div class="setting-item clickable" id="btn-force-sync"><span><i class="fas fa-cloud-upload-alt" style="color: var(--primary);"></i> 强制覆盖云端</span><i class="fas fa-chevron-right"></i></div>
                    <div class="setting-item clickable" id="btn-clear-data" style="color: #ff4d4d;"><span><i class="fas fa-trash"></i> 清空数据</span><i class="fas fa-chevron-right"></i></div>
                </div>
                <div class="app-version">Version 2.3.2 (UI Fix)</div>
            </div>
        </div>

        <div id="view-study" class="view hidden">
            <div class="study-header">
                <button class="btn-icon" id="exit-study"><i class="fas fa-chevron-left"></i> 返回</button>
                <span id="study-progress">0/0</span>
                <div class="study-actions">
                    <button class="btn-icon" id="btn-edit-card-study"><i class="fas fa-edit"></i></button>
                    <button class="btn-icon" id="btn-delete-card-study" style="color: #ff4d4d;"><i class="fas fa-trash"></i></button>
                </div>
            </div>
            <div class="flashcard-container">
                <div class="flashcard" id="flashcard">
                    <div class="card-front">
                        <div class="card-label">正面</div>
                        <div id="card-front-image" class="card-image hidden"></div>
                        <div class="card-content rich-text" id="card-front-content"></div>
                        <div class="card-tags" id="card-front-tags"></div>
                        <button class="btn-text tts-btn" id="tts-btn-front"><i class="fas fa-volume-up"></i> <span>朗读</span><div class="wave hidden"><span></span><span></span><span></span></div></button>
                    </div>
                    <div class="card-back hidden" id="card-back-wrapper">
                        <hr>
                        <div class="card-label">背面</div>
                        <div id="card-back-image" class="card-image hidden"></div>
                        <div class="card-content rich-text" id="card-back-content"></div>
                        <button class="btn-text tts-btn" id="tts-btn-back"><i class="fas fa-volume-up"></i> <span>朗读</span><div class="wave hidden"><span></span><span></span><span></span></div></button>
                    </div>
                    <!-- 提示语移入卡片内部 -->
                    <div class="card-hint">点击翻转</div>
                </div>
            </div>
            <div class="controls hidden" id="study-controls">
                <button class="btn-rate rate-again" data-rating="again">全忘<br><small id="time-again">-</small></button>
                <button class="btn-rate rate-hard" data-rating="hard">模糊<br><small id="time-hard">-</small></button>
                <button class="btn-rate rate-good" data-rating="good">犹豫<br><small id="time-good">-</small></button>
                <button class="btn-rate rate-easy" data-rating="easy">秒懂<br><small id="time-easy">-</small></button>
            </div>
        </div>

        <div id="view-manage" class="view hidden">
            <div class="manage-header"><button class="btn-icon" id="exit-manage"><i class="fas fa-chevron-left"></i></button><span id="manage-title">列表</span><button class="btn-icon" id="btn-batch-import"><i class="fas fa-file-import"></i></button></div>
            <div class="search-bar"><input type="text" id="manage-search-input" placeholder="搜索..."></div>
            <div class="card-list" id="manage-card-list"></div>
        </div>
        <div id="view-trash" class="view hidden">
            <div class="manage-header"><button class="btn-icon" id="exit-trash"><i class="fas fa-chevron-left"></i></button><span>回收站</span><button class="btn-icon" id="btn-empty-trash" style="color: #ff4d4d;"><i class="fas fa-ban"></i></button></div>
            <div class="tabs"><div class="tab active" data-tab="trash-cards">卡片</div><div class="tab" data-tab="trash-decks">记忆库</div></div>
            <div id="trash-list-container" class="card-list"></div>
        </div>
    </main>

    <button id="fab-add" class="fab-btn"><i class="fas fa-plus"></i></button>

    <!-- 弹窗组件 -->
    <div id="global-search-overlay" class="hidden" style="position:fixed;inset:0;background:var(--bg-color);z-index:2000;display:flex;flex-direction:column;">
        <div style="padding:15px;background:var(--card-bg);border-bottom:1px solid var(--border-color);display:flex;gap:10px;">
            <input type="text" id="global-search-input" placeholder="搜索..." style="flex:1;padding:10px;border:1px solid var(--border-color);border-radius:8px;background:var(--bg-color);color:var(--text-color);">
            <button id="close-global-search" style="background:none;border:none;color:var(--text-color);">取消</button>
        </div>
        <div id="global-search-results" style="flex:1;overflow-y:auto;padding:15px;"></div>
    </div>
    <div id="modal-overlay" class="hidden">
        <div id="modal-deck" class="modal-box hidden">
            <h3>新建记忆库</h3>
            <div class="input-group"><label>名称</label><input type="text" id="input-deck-name"></div>
            <div class="modal-actions"><button class="btn-text" id="btn-cancel-deck">取消</button><button class="btn-primary" id="btn-save-deck">创建</button></div>
        </div>
        <div id="modal-card" class="modal-box hidden">
            <h3 id="modal-card-title">卡片</h3>
            <div class="input-group"><label>库</label><select id="input-card-deck"></select></div>
            
            <div class="input-group" style="border:1px solid var(--border-color); padding:10px; border-radius:8px;">
                <label style="font-weight:bold; color:var(--primary);">正面 (问题)</label>
                <textarea id="input-card-front" rows="2" placeholder="输入文字..." style="margin-bottom:10px;"></textarea>
                <div class="image-upload-area" id="btn-upload-front" style="padding:8px; font-size:0.8rem;">
                    <i class="fas fa-image"></i> 添加正面图片
                </div>
                <input type="file" id="file-front" accept="image/*" style="display:none">
                <div id="preview-front-container" class="hidden" style="position:relative; margin-top:5px;">
                    <img id="preview-front-img" src="" style="max-width:100%; max-height:100px; border-radius:4px;">
                    <button id="btn-remove-front" style="position:absolute; top:-5px; right:-5px; background:red; color:white; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer;">×</button>
                </div>
            </div>

            <div class="input-group" style="border:1px solid var(--border-color); padding:10px; border-radius:8px;">
                <label style="font-weight:bold; color:var(--primary);">背面 (答案)</label>
                <textarea id="input-card-back" rows="2" placeholder="输入文字..." style="margin-bottom:10px;"></textarea>
                <div class="image-upload-area" id="btn-upload-back" style="padding:8px; font-size:0.8rem;">
                    <i class="fas fa-image"></i> 添加背面图片
                </div>
                <input type="file" id="file-back" accept="image/*" style="display:none">
                <div id="preview-back-container" class="hidden" style="position:relative; margin-top:5px;">
                    <img id="preview-back-img" src="" style="max-width:100%; max-height:100px; border-radius:4px;">
                    <button id="btn-remove-back" style="position:absolute; top:-5px; right:-5px; background:red; color:white; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer;">×</button>
                </div>
            </div>

            <div class="input-group"><label>标签</label><input type="text" id="input-card-tags"></div>
            <div class="modal-actions"><button class="btn-text" id="btn-cancel-card">取消</button><button class="btn-primary" id="btn-save-card">保存</button></div>
        </div>
        <div id="modal-batch" class="modal-box hidden">
            <h3>批量导入</h3>
            <p style="font-size:0.8rem;color:#666;margin-bottom:10px;">格式：正面||背面 (一行一条)</p>
            <div class="input-group"><textarea id="input-batch-text" rows="10"></textarea></div>
            <div class="modal-actions"><button class="btn-text" id="btn-cancel-batch">取消</button><button class="btn-primary" id="btn-save-batch">导入</button></div>
        </div>
    </div>
    <div id="action-sheet-overlay" class="hidden">
        <div class="action-sheet">
            <button class="sheet-btn" id="btn-sheet-deck"><i class="fas fa-folder-plus" style="color:var(--primary);"></i> 建库</button>
            <button class="sheet-btn" id="btn-sheet-card"><i class="fas fa-file-medical" style="color:var(--success-color);"></i> 加卡</button>
            <button class="sheet-btn cancel" id="btn-sheet-cancel">取消</button>
        </div>
    </div>

    <nav class="nav-footer" id="nav-footer">
        <div class="nav-item active" data-target="view-decks"><i class="fas fa-book"></i><span>记忆库</span></div>
        <div class="nav-item" data-target="view-stats"><i class="fas fa-chart-pie"></i><span>统计</span></div>
        <div class="nav-item" data-target="view-settings"><i class="fas fa-cog"></i><span>设置</span></div>
    </nav>
    <div id="loading-mask" class="hidden"><div class="spinner"></div><p>处理中...</p></div>
    <div id="toast"></div>

    <script type="module" src="js/app.js"></script>
</body>
</html>